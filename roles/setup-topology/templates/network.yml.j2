name: {{ networkname }}

topology:
  defaults:
    kind: linux
  nodes:
    router1-WAN:
      image: {{ frrimage }}
      binds:
        - /etc/containerlab/{{networkname}}/router1-WAN/daemons:/etc/frr/daemons
        - /etc/containerlab/{{networkname}}/router1-WAN/frr.conf:/etc/frr/frr.conf
    router2-LAN:
      image: {{ frrimage }}
      binds:
        - /etc/containerlab/{{networkname}}/router2-LAN/daemons:/etc/frr/daemons
        - /etc/containerlab/{{networkname}}/router2-LAN/frr.conf:/etc/frr/frr.conf
    router3-Internet:
      image: {{ frrimage }}
      binds:
        - /etc/containerlab/{{networkname}}/router3-Internet/daemons:/etc/frr/daemons
        - /etc/containerlab/{{networkname}}/router3-Internet/frr.conf:/etc/frr/frr.conf
    br1-DMZ:
      image: {{ bridgeclientimage }}
    br2-LAN:
      image: {{ bridgeclientimage }}
    br3-Internet:
      image: {{ bridgeclientimage }}
    Standalone-Client-LAN:
      image: {{ bridgeclientimage }}
    Ubuntu-Client-LAN:
      image: {{ ubuntuserverimage }}
    Attacker-LAN:
      image: {{ ubuntuserverimage }}
{% for i in range(1, NumberofLANclients | int +1) %}
    Client{{ i }}-LAN:
      image: {{ bridgeclientimage }}
{% endfor %}
    Server1-nginx-LAN:
      image: {{ webservernginximage }}
      binds:
        - /etc/containerlab/{{networkname}}/LANsite.conf:/etc/nginx/conf.d/default.conf
    Server2-ubuntu-LAN:
      image: {{ ubuntuserverimage }}
{% for i in range(1, NumberofWANwebclients | int +1) %}
    Client{{ i }}-WANweb:
      image: {{ bridgeclientimage }}
      binds:
        - /etc/containerlab/{{networkname}}/WANweb.sh:/WANweb.sh
      cmd: nohup bash WANweb.sh &
{% endfor %}
{% for i in range(1, NumberofWANvpnclients | int +1) %}
    Client{{ i }}-WANvpn:
      image: {{ bridgeclientimage }}
      binds:
        - /etc/containerlab/{{networkname}}/WANvpn.sh:/WANvpn.sh
      cmd: nohup bash WANvpn.sh &
{% endfor %}
    Attacker-WAN:
      image: python:3.7-slim
    Server1-nginx-WAN:
      image: {{ webservernginximage }}
      binds:
        - /etc/containerlab/{{networkname}}/WANsite.conf:/etc/nginx/conf.d/default.conf
    Server2-ubuntu-WAN:
      image: {{ ubuntuserverimage }}
    Server3-DNS-WAN:
      image: {{ ubuntuserverimage }}
      binds:
        - /etc/containerlab/{{networkname}}/nsd.conf:/etc/nsd/nsd.conf
        - /etc/containerlab/{{networkname}}/LANsite.dev.zone:/etc/nsd/LANsite.dev.zone
        - /etc/containerlab/{{networkname}}/WANsite.dev.zone:/etc/nsd/WANsite.dev.zone

  links:
{% for k in range(1, NumberofWANwebclients | int +1) %}
    - endpoints: ["Client{{ k }}-WANweb:eth1", "br3-Internet:eth{{ k + staticinterfaces_br3Internet|int }}"]
{% endfor %}
{% for j in range(1, NumberofWANvpnclients | int +1) %}
    - endpoints: ["Client{{ j }}-WANvpn:eth1", "br3-Internet:eth{{ j + staticinterfaces_br3Internet|int + NumberofWANwebclients|int }}"]
{% endfor %}
    - endpoints: ["Server3-DNS-WAN:eth1", "br3-Internet:eth7"]
    - endpoints: ["Attacker-WAN:eth1", "br3-Internet:eth6"]
    - endpoints: ["Server1-nginx-WAN:eth1", "br3-Internet:eth5"]
    - endpoints: ["Server2-ubuntu-WAN:eth1", "br3-Internet:eth4"]
    - endpoints: ["br3-Internet:eth3", "router3-Internet:eth4"]
    - endpoints: ["br3-Internet:eth2", "router3-Internet:eth3"]
    - endpoints: ["br3-Internet:eth1", "router3-Internet:eth2"]
    - endpoints: ["router3-Internet:eth1", "router1-WAN:eth1"]
    - endpoints: ["router1-WAN:eth3", "br1-DMZ:eth1"]
    - endpoints: ["Server1-nginx-LAN:eth1", "br1-DMZ:eth2"]
    - endpoints: ["Server2-ubuntu-LAN:eth1", "br1-DMZ:eth3"]    
    - endpoints: ["router1-WAN:eth2", "router2-LAN:eth1"]
    - endpoints: ["router2-LAN:eth2", "br2-LAN:eth1"]
    - endpoints: ["router2-LAN:eth3", "br2-LAN:eth2"]
    - endpoints: ["router2-LAN:eth4", "br2-LAN:eth3"]
    - endpoints: ["Attacker-LAN:eth1", "br2-LAN:eth4"]
    - endpoints: ["Ubuntu-Client-LAN:eth1", "br2-LAN:eth6"]
    - endpoints: ["Standalone-Client-LAN:eth1", "br2-LAN:eth5"]
{% for y in range(1, NumberofLANclients | int +1) %}
    - endpoints: ["Client{{ y }}-LAN:eth1", "br2-LAN:eth{{ y + staticinterfaces_br2lan|int }}"]
{% endfor %}