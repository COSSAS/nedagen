---

- name: Make Containerlab network directory
  become: yes
  file:
    path: /etc/containerlab/{{ networkname }}
    state: directory

# - name: Log into DockerHub
#   become: yes
#   docker_login:
#     username: "{{ Dockerhub_Username }}"
#     password: "{{ Dockerhub_Password }}"    
#     reauthorize: yes

- name: Create Configuration Directories
  become: yes
  file:
    path: /etc/containerlab/{{ networkname }}/{{ item }}
    state: directory
  loop:
    - router-WAN
    - router-LAN1
    - router-LAN2
    - router-Internet
    - nginx
    - dns
    - traffic-generation
    - profiles
    - LANclient_scripts
    - WANclient_scripts

- name: Set router WAN files
  become: yes
  copy:
    src: router-WAN/{{ item }}
    dest: /etc/containerlab/{{ networkname }}/router-WAN/{{ item }}
  loop:
    - daemons
    - frr.conf

- name: Set router LAN1 files
  become: yes
  copy:
    src: router-LAN1/{{ item }}
    dest: /etc/containerlab/{{ networkname }}/router-LAN1/{{ item }}
  loop:
    - daemons
    - frr.conf

- name: Set router LAN2 files
  become: yes
  copy:
    src: router-LAN2/{{ item }}
    dest: /etc/containerlab/{{ networkname }}/router-LAN2/{{ item }}
  loop:
    - daemons
    - frr.conf

- name: Set router Internet files
  become: yes
  copy:
    src: router-Internet/{{ item }}
    dest: /etc/containerlab/{{ networkname }}/router-Internet/{{ item }}
  loop:
    - daemons
    - frr.conf

- name: Set SMB Configuration Files
  become: yes
  template:
    src: SMBconf.sh.j2
    dest: /etc/containerlab/{{ networkname }}/SMBconf.sh

- name: Copy DMZsite config
  become: yes
  copy:
    src: nginx/DMZsite.conf
    dest: /etc/containerlab/{{ networkname }}/nginx/DMZsite.conf

- name: Copy httpsDMZ config
  become: yes
  copy:
    src: nginx/httpsDMZsite.conf
    dest: /etc/containerlab/{{ networkname }}/nginx/httpsDMZsite.conf
    mode: '0744'

- name: Copy NSD config
  become: yes
  copy:
    src: dns/nsd.conf
    dest: /etc/containerlab/{{ networkname }}/dns/nsd.conf
    mode: 0644

- name: Copy NSD DMZsite config
  become: yes
  copy:
    src: dns/DMZsite.dev.zone
    dest: /etc/containerlab/{{ networkname }}/dns/DMZsite.dev.zone
    mode: 0644

- name: Copy NSD httpsDMZsite config
  become: yes
  copy:
    src: dns/httpsDMZsite.dev.zone
    dest: /etc/containerlab/{{ networkname }}/dns/httpsDMZsite.dev.zone
    mode: 0644

- name: Copy config variables
  become: yes
  copy:
    src: config.yml
    dest: /etc/containerlab/{{ networkname }}/config.yml

- name: Copy SSH Traffic Generation Script
  become: yes
  copy:
    src: traffic-generation/ssh.sh
    dest: /etc/containerlab/{{ networkname }}/traffic-generation/ssh.sh
    mode: 0744

- name: Copy ICMP Traffic Generation Script
  become: yes
  copy:
    src: traffic-generation/pingServers.sh
    dest: /etc/containerlab/{{ networkname }}/traffic-generation/pingServers.sh
    mode: 0744

- name: Copy LANweb.sh
  become: yes
  copy:
    src: traffic-generation/LANweb.sh
    dest: /etc/containerlab/{{ networkname }}/traffic-generation/LANweb.sh
    mode: 0744

- name: Copy WANweb.sh
  become: yes
  copy:
    src: traffic-generation/WANweb.sh
    dest: /etc/containerlab/{{ networkname }}/traffic-generation/WANweb.sh
    mode: 0744

- name: Configure network topology
  become: yes
  template:
    src: network.yml.j2
    dest: /etc/containerlab/{{ networkname }}/network.yml

- name: Copy ALS_profiles_LAN.sh
  become: yes
  template:
    src: profiles/ALS_profiles_LAN.sh.j2
    dest: /etc/containerlab/{{ networkname }}/profiles/ALS_profiles_LAN.sh
    mode: 0744
    
- name: Copy ALS_profiles_WAN.sh
  become: yes
  template:
    src: profiles/ALS_profiles_WAN.sh.j2
    dest: /etc/containerlab/{{ networkname }}/profiles/ALS_profiles_WAN.sh
    mode: 0744