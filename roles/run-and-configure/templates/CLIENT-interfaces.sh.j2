#!/bin/sh

docker exec -d clab-{{networkname}}-Standalone-Client-LAN ip addr add 192.168.10.2/24 dev eth1
docker exec -d clab-{{networkname}}-Standalone-Client-LAN ip route delete default
docker exec -d clab-{{networkname}}-Standalone-Client-LAN ip route add 0.0.0.0/0 via 192.168.10.1 dev eth1
docker exec -d clab-{{networkname}}-Standalone-Client-LAN bash -c 'echo "nameserver 5.5.5.5" > /etc/resolv.conf'

{% for k in range(1, NumberofLANclients | int +1 ) %}
docker exec -d clab-{{networkname}}-Client{{k}}-LAN ip addr add 192.168.20.{{k+1}}/24 dev eth1
docker exec -d clab-{{networkname}}-Client{{k}}-LAN ip route delete default
docker exec -d clab-{{networkname}}-Client{{k}}-LAN ip route add 0.0.0.0/0 via 192.168.20.1 dev eth1
docker exec -d clab-{{networkname}}-Client{{k}}-LAN bash -c 'echo "nameserver 5.5.5.5" > /etc/resolv.conf'
{% endfor %}

docker exec clab-{{networkname}}-Attacker-LAN apt-get update -y
docker exec clab-{{networkname}}-Attacker-LAN apt-get install iproute2 -y
docker exec clab-{{networkname}}-Attacker-LAN apt-get install inetutils-ping -y

docker exec -d clab-{{networkname}}-Attacker-LAN ip addr add 192.168.30.2/24 dev eth1
docker exec -d clab-{{networkname}}-Attacker-LAN ip route delete default
docker exec -d clab-{{networkname}}-Attacker-LAN ip route add 0.0.0.0/0 via 192.168.30.1 dev eth1
docker exec -d clab-{{networkname}}-Attacker-LAN bash -c 'echo "nameserver 5.5.5.5" > /etc/resolv.conf'

docker exec clab-{{networkname}}-Ubuntu-Client-LAN apt-get update -y
docker exec clab-{{networkname}}-Ubuntu-Client-LAN apt-get install iproute2 -y
docker exec clab-{{networkname}}-Ubuntu-Client-LAN apt-get install inetutils-ping -y

docker exec -d clab-{{networkname}}-Ubuntu-Client-LAN ip addr add 192.168.30.3/24 dev eth1
docker exec -d clab-{{networkname}}-Ubuntu-Client-LAN ip route delete default
docker exec -d clab-{{networkname}}-Ubuntu-Client-LAN ip route add 0.0.0.0/0 via 192.168.30.1 dev eth1
docker exec -d clab-{{networkname}}-Ubuntu-Client-LAN bash -c 'echo "nameserver 5.5.5.5" > /etc/resolv.conf'

docker exec clab-{{networkname}}-Attacker-WAN export DEBIAN_FRONTEND=noninteractive
docker exec clab-{{networkname}}-Attacker-WAN apt-get update -y
docker exec clab-{{networkname}}-Attacker-WAN apt-get install iproute2 -y
docker exec clab-{{networkname}}-Attacker-WAN apt-get install inetutils-ping -y
docker exec clab-{{networkname}}-Attacker-WAN apt-get -yq install pip python3 git ssh
docker exec clab-{{networkname}}-Attacker-WAN pip install atomic-operator
docker exec clab-{{networkname}}-Attacker-WAN atomic-operator get_atomics --destination "/root/atomic-operator"

docker exec -d clab-{{networkname}}-Attacker-WAN ip addr add 5.100.0.100/8 dev eth1
docker exec -d clab-{{networkname}}-Attacker-WAN ip route delete default
docker exec -d clab-{{networkname}}-Attacker-WAN ip route add 0.0.0.0/0 via 5.0.0.1 dev eth1
docker exec -d clab-{{networkname}}-Attacker-WAN bash -c 'echo "nameserver 5.5.5.5" > /etc/resolv.conf'
