#!/bin/sh

docker exec -d clab-{{networkname}}-router-WAN {{ ipv6_configuration }}
docker exec -d clab-{{networkname}}-router-WAN ip route delete default

docker exec -d clab-{{networkname}}-router-LAN1 {{ ipv6_configuration }}
docker exec -d clab-{{networkname}}-router-LAN1 ip route delete default

docker exec -d clab-{{networkname}}-router-LAN2 {{ ipv6_configuration }}
docker exec -d clab-{{networkname}}-router-LAN2 ip route delete default

docker exec -d clab-{{networkname}}-router-Internet {{ ipv6_configuration }}
docker exec -d clab-{{networkname}}-router-Internet ip route delete default

docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -d 10.0.0.0/8 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -d 192.168.0.0/16 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -d 172.16.0.0/12 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -d 127.0.0.0/8 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -d 169.254.0.0/16 -j DROP

docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -s 10.0.0.0/8 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -s 192.168.0.0/16 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -s 172.16.0.0/12 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -s 127.0.0.0/8 -j DROP
docker exec -d clab-{{networkname}}-router-Internet iptables -A FORWARD -s 169.254.0.0/16 -j DROP

docker exec -d clab-{{networkname}}-router-LAN1 iptables --table nat --append POSTROUTING --out-interface eth1 -j MASQUERADE
docker exec -d clab-{{networkname}}-router-LAN2 iptables --table nat --append POSTROUTING --out-interface eth1 -j MASQUERADE
docker exec -d clab-{{networkname}}-router-LAN2 iptables -A PREROUTING --table nat -i eth3 -p udp --dport 500 -j DNAT --to 192.168.40.10:500
docker exec -d clab-{{networkname}}-router-LAN2 iptables -A FORWARD -p udp -d 192.168.40.10 --dport 500 -j ACCEPT
docker exec -d clab-{{networkname}}-router-LAN2 iptables -A PREROUTING --table nat -i eth3 -p udp --dport 4500 -j DNAT --to 192.168.40.10:4500
docker exec -d clab-{{networkname}}-router-LAN2 iptables -A FORWARD -p udp -d 192.168.40.10 --dport 4500 -j ACCEPT

docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -d 123.123.100.10 -p tcp --dport 80 -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -s 123.123.100.10 -p tcp -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -d 123.123.100.12 -p tcp --dport 443 -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -s 123.123.100.12 -p tcp -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -s 123.123.100.11 -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -d 123.123.100.11 -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -s 123.123.123.2 -j ACCEPT
docker exec -d clab-{{networkname}}-router-WAN iptables -A FORWARD -d 123.123.123.2 -j ACCEPT
